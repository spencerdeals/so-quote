    function render(q){
      const tbody=document.querySelector('#tbl tbody');
      const theadSimple=document.getElementById('thead-simple');
      const theadAdmin=document.getElementById('thead-admin');
      const ADMIN = /[?&](admin|debug)=1/.test(location.search);
      theadSimple.style.display = ADMIN ? 'none' : '';
      theadAdmin.style.display = ADMIN ? '' : 'none';
      tbody.innerHTML='';

      q.items.forEach((it,idx)=>{
        const first = it.firstCost ?? Number(it.unit || 0);
        const unitLanded = it.unitLanded ?? (first+(it.freight||0)+(it.fees||0)+(it.duty||0));
        const total = it.total ?? (it.qty * unitLanded);

        const tr=document.createElement('tr');

        // --- if no price was scraped, show manual input box ---
        if(first <= 0){
          tr.innerHTML=`<td>${it.title}</td>
            <td><input type="number" min="1" value="${it.qty}" data-i="${idx}" class="input qty" style="max-width:70px"></td>
            <td><input type="number" min="1" placeholder="Enter price" data-i="${idx}" class="input price" style="max-width:120px"></td>
            <td class="rowtotal">${fmt(total)}</td>`;
        } else {
          tr.innerHTML=`<td>${it.title}</td>
            <td><input type="number" min="1" value="${it.qty}" data-i="${idx}" class="input qty" style="max-width:70px"></td>
            <td>${fmt(unitLanded)}</td>
            <td class="rowtotal">${fmt(total)}</td>`;
        }

        tbody.appendChild(tr);
        it.unitLanded = unitLanded;
        it.total = total;
      });

      const sub = q.subtotal ?? q.items.reduce((s,x)=>s+(x.total||0),0);
      q.subtotal = sub;
      document.getElementById('subtotal').textContent=fmt(sub);

      // --- handle qty changes ---
      tbody.querySelectorAll('input.qty').forEach(inp=>{
        inp.addEventListener('input',e=>{
          const i=Number(e.target.dataset.i);
          const qty=Math.max(1,Number(e.target.value||1));
          quote.items[i].qty=qty;
          quote.items[i].total=qty*(quote.items[i].unitLanded||0);
          e.target.closest('tr').querySelector('.rowtotal').textContent=fmt(quote.items[i].total);
          quote.subtotal=quote.items.reduce((s,x)=>s+(x.total||0),0);
          document.getElementById('subtotal').textContent=fmt(quote.subtotal);
        });
      });

      // --- handle manual price input ---
      tbody.querySelectorAll('input.price').forEach(inp=>{
        inp.addEventListener('input',e=>{
          const i=Number(e.target.dataset.i);
          const price=Math.max(1,Number(e.target.value||0));
          quote.items[i].firstCost = price;
          quote.items[i].unitLanded = price + (quote.items[i].freight||0)+(quote.items[i].fees||0)+(quote.items[i].duty||0);
          quote.items[i].total = (quote.items[i].qty||1) * quote.items[i].unitLanded;
          e.target.closest('tr').querySelector('.rowtotal').textContent=fmt(quote.items[i].total);
          quote.subtotal=quote.items.reduce((s,x)=>s+(x.total||0),0);
          document.getElementById('subtotal').textContent=fmt(quote.subtotal);
        });
      });
    }
