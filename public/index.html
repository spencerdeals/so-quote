<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Special Order – Instant Quote</title>
  <style>
    :root { --accent:#2c7a3f; --text:#333; --muted:#6b7280; --border:#d0d5dd; --bg:#fff; }
    html, body { margin:0; padding:0; background:transparent; color:var(--text); font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; }
    *, *:before, *:after { box-sizing:border-box; }
    .wrap { max-width:960px; margin:40px auto; padding:24px; }
    h1 { font-size:24px; margin:0 0 24px; font-weight:700; text-align:center; }
    form { display:grid; gap:16px; }
    label { font-weight:600; font-size:14px; color:#111827; }
    input, select { width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:6px; background:#fff; color:var(--text); outline:none; }
    input:focus, select:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(44,122,63,.2); }
    button { height:46px; border:none; border-radius:8px; background:var(--accent); color:#fff; font-weight:700; cursor:pointer; }
    button:disabled { opacity:.6; cursor:default; }
    .hint { font-size:12px; color:var(--muted); margin-top:-6px; }
    .result { margin-top:24px; padding:16px; border:1px solid var(--border); border-radius:8px; background:#f9fafb; }
    .result h2 { margin:0 0 12px; font-size:18px; }
    .result table { width:100%; border-collapse:collapse; }
    .result td { padding:6px 0; }
    .result td:last-child { text-align:right; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Special Order – Instant Quote</h1>

    <form id="quoteForm">
      <label>Item link (Amazon, Wayfair, etc.)
        <input type="url" id="link" required placeholder="https://example.com/product" />
      </label>
      <div class="hint">Amazon/Wayfair treated as tax-exempt (your rule). Others charged 6.625% NJ sales tax.</div>

      <label>Category
        <select id="category" required>
          <option value="">Select…</option>
          <option value="upholstered">Upholstered furniture (25% duty)</option>
          <option value="other">Other (0% duty by default)</option>
        </select>
      </label>

      <label>First cost per unit (USD)
        <input type="number" id="cost" step="0.01" min="0" required placeholder="e.g. 550" />
      </label>

      <label>Carton volume per unit (ft³)
        <input type="number" id="volume" step="0.01" min="0" placeholder="Leave blank to use 11.33 ft³" />
      </label>

      <label>Quantity
        <input type="number" id="qty" min="1" value="1" />
      </label>

      <button type="submit" id="goBtn">Get Quote</button>
    </form>

    <div id="output" class="result" style="display:none;">
      <h2>Quote Result</h2>
      <div id="quoteTable"></div>
      <div class="hint">Includes US tax (if applicable), freight, fixed fees, duty, wharfage (2%), margin, and card fee 3.25%. Duty applied to first cost only.</div>
    </div>
  </div>

  <script>
    const fmt = n => `$${Number(n).toFixed(2)}`;

    document.getElementById("quoteForm").addEventListener("submit", function(e){
      e.preventDefault();
      const btn = document.getElementById("goBtn");
      btn.disabled = true;

      const link = (document.getElementById("link").value || "").trim();
      const cost = parseFloat(document.getElementById("cost").value);
      const qty = parseInt(document.getElementById("qty").value) || 1;
      const volPerUnit = parseFloat(document.getElementById("volume").value) || 11.33;
      const category = document.getElementById("category").value;

      // --- Core assumptions from your saved workflow ---
      const taxRate = /(amazon|wayfair)\./i.test(link) ? 0 : 0.06625;           // 6.625% unless tax-exempt vendor
      const freightRate = 16.17;                                                // $/ft³ (FFF Aug 2025 LCL reference)
      const fixedFeesTotal = 148;                                               // per-shipment, allocated per unit
      const dutyRate = category === "upholstered" ? 0.25 : 0.00;                // duty on first cost only
      const wharfageRate = 0.02;                                                // 2% (your request to include wharfage)
      const cardFeeRate = 0.0325;                                               // 3.25%

      // Dynamic margin tiers + value caps
      const totalVol = volPerUnit * qty;
      const baseMargin =
        totalVol < 10 ? 0.40 :
        totalVol < 20 ? 0.30 :
        totalVol < 50 ? 0.25 : 0.20;

      // --- Per-unit build ---
      const usTax = cost * taxRate;                                             // tax on first cost
      const freightPerUnit = (volPerUnit * freightRate);                        // simple LCL estimate
      const fixedFeesPerUnit = fixedFeesTotal / qty;
      const duty = cost * dutyRate;                                             // duty on first cost only
      const wharfage = cost * wharfageRate;                                     // wharfage set at 2% of first cost

      const landed = cost + usTax + freightPerUnit + fixedFeesPerUnit + duty + wharfage;

      // Margin caps by landed value
      let margin = baseMargin;
      if (landed > 1000) margin = Math.min(margin, 0.25);
      if (landed > 3000) margin = Math.min(margin, 0.20);
      if (landed > 5000) margin = Math.min(margin, 0.15);

      // Retail: add margin, then card fee, then round to *.95
      let retail = landed * (1 + margin);
      retail *= (1 + cardFeeRate);
      retail = Math.round(retail) - 0.05;

      const totalRetail = retail * qty;

      // Render table
      const rows = [
        ["Source", `<a href="${link}" target="_blank" rel="noopener noreferrer">${link || "-"}</a>`],
        ["Qty", qty],
        ["Total volume", `${(volPerUnit * qty).toFixed(2)} ft³`],
        ["First cost (per unit)", fmt(cost)],
        ["US sales tax", fmt(usTax)],
        ["Duty", fmt(duty)],
        ["Wharfage (2%)", fmt(wharfage)],
        ["Freight (per unit)", fmt(freightPerUnit)],
        ["Fixed fees (per unit)", fmt(fixedFeesPerUnit)],
        ["Landed (per unit)", `<strong>${fmt(landed)}</strong>`],
        ["Margin applied", `${Math.round(margin*100)}%`],
        ["Retail (per unit)", `<strong>${fmt(retail)}</strong>`],
        ["Total retail", `<strong>${fmt(totalRetail)}</strong>`],
      ];

      const html = `
        <table>
          ${rows.map(r => `<tr><td>${r[0]}</td><td style="text-align:right">${r[1]}</td></tr>`).join("")}
        </table>
      `;

      document.getElementById("quoteTable").innerHTML = html;
      document.getElementById("output").style.display = "block";
      btn.disabled = false;
    });
  </script>
</body>
</html>
